---
title: 'Tipologia i cicle de vida de les dades: PRACTICA2'
author: "Autor: Oriol Toll i Laura Gassó"
date: "May 2022"
output:
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
    includes:
      in_header: 05.584-PAC-header.html
  word_document: default
  pdf_document:
    highlight: zenburn
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*****
# Introducció
*****

Aquest projecte pretén posar en pràctica les activitats que es duen a terme en les fases inicials d'un projecte de mineria de dades. Aquestes tenen com a objectiu obtenir un domini de les dades amb les que es construirà el model de mineria. És vital coneixer profundament les dades tant en el seu format com contingut. Tasques típiques poden ser la selecció de característiques o variables, la preparació del joc de dades per a posteriorment ser consumit per un algorisme (tractament de valors nuls i outliers, transformacions, codificació de les variables categòriques, etc) i intentar extreure el màxim coneixement possible de les dades.

Per a la resolució d'aquest projecte es farà ús del dataset de **Titànic** obtingut de la pàgina de kaggle: https://www.kaggle.com/competitions/titanic/data

*****
# Resolució
*****

S'instal·len i es carreguen les llibreries

```{r setup libraries, include=TRUE,  message=FALSE, warning=FALSE}
# Set libraries
library(data.table)
library(tidyr)
# https://cran.r-project.org/web/packages/arules/index.html
if (!require('arules')) install.packages('arules'); library('arules')
# https://cran.r-project.org/web/packages/ggplot2/index.html
if (!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
# https://cran.r-project.org/web/packages/dplyr/index.html
if (!require('dplyr')) install.packages('dplyr'); library('dplyr')
if (!require("DT")) install.packages('DT'); library('DT')
```

Es carreguen els fitxers de dades.

```{r import data, echo=TRUE, message=FALSE, warning=FALSE}

# Load data
raw.train <- data.table::fread("./data/train.csv", dec = ".")
raw.test <- data.table::fread("./data/test.csv", dec = ".")
```


## Exploració de les dades i descripció del dataset

El dataset Titànic representa informació sobre els passatgers i la tripulació que anava en el Titànic en el moment del naufràgi. A partir de l'anàlisi dels supervivents i els morts en aquest accident, es poden compèndre els critèris i procediments d'evacuació que es van dur a terme en el moment del sinistre.

S'uneix el joc de dades de train i test per tal de realitzar les tasques de neteja i processament.

```{r , echo=TRUE, message=FALSE, warning=FALSE}
# Get full dataset

# Check if any label on training is missing
if(sum(is.na(raw.train$Survived)) == 0) {

  # Join train and test set  
  test <- raw.test[, Survived := NA]
  total.data <- rbind(raw.train, test)
} else {
  print('There are some missing values in dependant variable on training data set')
}

```

Es verifica l'estructura del joc de dades principal.

```{r}
str(total.data)
```

S'observa que es tenen 1309 registres que corresponen als viatgers i tripulació del Titànic i 11 variables que els caracteritzen.

Es revisa la descripció de les variables contingudes al fitxer i si els tipus de variable es correspon al que s'ha carregat:


**PassengerId**
    integer with the id of the row (one for each passenger)
    
**Survived**
    a factor with two levels (no and yes) specifying whether the person has survived the sinking.

**Pclass**
    factor specifying the class for passengers or the type of service aboard for crew members.
    
**Name**
    string with the name of the passenger.
    
**Sex**
    factor with levels male and female.
    
**Age**
    numeric value with the persons age on the day of the sinking. The age of babies (under 12 months) is given as a fraction of one year (1/month).
    
 **SibSp**
    ordered factor specifying the number if siblings/spouses aboard; adopted from Vanderbild data set.

**Parch**
    an ordered factor specifying the number of parents/children aboard; adopted from Vanderbild data set.

**Ticket**
  string specifying the persons ticket number (NA for crew members).

**Fare**
    numeric value with the ticket price (NA for crew members, musicians and employees of the shipyard company).

**Cabin**
    string specifying the persons cabin
    
**Embarked**
    factor with the persons place of embarkment.


Es treuen les estadístiques bàsiques.

```{r , echo=TRUE, message=FALSE, warning=FALSE}
# Get data summary 
summary(total.data)
```
 
## Integració i selecció de les dades d’interès a analitzar

Les dades que s'utlitzaran són les que anteriorment s'han ajuntat del data de *test* i el de *train.* Tot i això, no s'estudiaran ni tractaran totes les variables, donat que variables com **PassengerID**, **Name**, **Cabin** o **Ticket**, ens aporten informació que no serà de cap utilitat per resoldre el problema inciial.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
work.data <- total.data[,-c(1, 4, 9, 11)]
```

## Neteja de les dades.

Estadístiques de valors buits.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
colSums(is.na(work.data))

colSums(work.data=="")
```

Assignem la mitjana per a valors buits de la variable **Age**.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
work.data$Age[is.na(work.data$Age)] <- mean(work.data$Age,na.rm=T)
```

Assignem un valor de **0** al valor buit de la variable **Fare**, ja que correspon al preu del tiquet d'un membre de la tripulació.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
work.data$Fare[is.na(work.data$Fare)] <- 0
```

Assignem valor **Desconegut** per a valors buits de la variable **Embarked**.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
work.data$Embarked[(work.data$Embarked == "")] <- "Desconegut"
```

## Anàlisi de les dades.

Per començar, es farà una representació gràfica per les variables que es volen analitzar, d'aquesta manera, es podrà tenir una idea principal de com es comporten totes elles: **[Jo aqui faria un ggplot amb cada una d'elles amb un gràfic simple pero maco]**

* *Age:*
* *SibSp:*
* *Parch:*
* *Fare:*

* *Survived:*
* *Pclass:*
* *Sex:*
* *Embarked:*

### Selecció dels grups de dades que es volen analitzar/comparar **[A la part de codi crec que no fa falta res, ja estan sepratas al principi les dades]**

Per començar a treballar amb les dades, es partirà de les taules de *train* i de *test*, cada una d'elles té la seva pròpia funcionalitat. Mentre que amb les dades de *train* s'utilitzaran per treballar i intentar resoldre el problema, les dades de *test* serviran per veure els resultats finals sobre aquells passatgers que no tenen informat el camp **Survived**.

D'aquesta manera, treballant amb les dades es podrà observar si els diferents atributs de la taula, van influir o no en que els passatgers sobrevisquéssin en l'accident del Titànic. 

```{r, echo=TRUE, message=FALSE, warning=FALSE}

```

### Comprovació de la normalitat i homogeneïtat de la variància. **[Proves sobre les 7 variables d'estudi, si no són normals, les normalitzem?]**

```{r, echo=TRUE, message=FALSE, warning=FALSE}

```

### Aplicació de proves estadístiques per comparar els grups de dades **[Proves amb el raw.train sobre Survived]**

```{r, echo=TRUE, message=FALSE, warning=FALSE}

```

## Representació dels resultats a partir de taules i gràfiques **[Aquest apartat està inclos en la resta]**

## Resolució del problema **[Model de regresio amb les conclusions anteriors?]**

```{r, echo=TRUE, message=FALSE, warning=FALSE}

```


## Taula de contribucions


```{r,  echo=FALSE, message=FALSE, warning=FALSE}
contributions <- data.table::data.table(Contribucions = c('Investigació previa', 'Redacció  de les respostes', 'Desenvolupament del codi'),
                                        Firma = rep(c('Oriol Toll, Laura Gassó'),3))

DT::datatable(contributions)
```









